---
- name: Release {{ current_release }}
  include_tasks: download-tarball.yml
  vars:
    date: "{{ current_release }}"
  args:
    apply:
      ignore_errors: yes
- name: Fallback to release {{ previous_release }}
  include_tasks: download-tarball.yml
  vars:
    date: "{{ previous_release }}"
  when: tarball_result is failed
- name: Create an empty container
  command: buildah from scratch
  register: buildah_from
- name: Mount container's root filesystem
  command: buildah mount {{ buildah_from.stdout }}
  register: buildah_mount
- name: Extract bootstrap tarball to mount point
  unarchive:
    src: "{{ path_to_bootstrap }}"
    dest: "{{ buildah_mount.stdout }}"
    extra_opts: [--strip-components=1]
